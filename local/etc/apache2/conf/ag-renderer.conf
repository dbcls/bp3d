LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_uwsgi_module modules/mod_proxy_uwsgi.so
LoadModule lbmethod_byrequests_module modules/mod_lbmethod_byrequests.so

ProxyRequests Off
ProxyVia Off

<Location /balancer-manager>
  SetHandler balancer-manager
  Order Allow,Deny
  Allow from All
</Location>
<Proxy *>
  Order deny,allow
  Deny from all
  allow from localhost 127.0.0.1
#  allow from localhost 127.0.0.1 172.19.1
</Proxy>
<Proxy http://lifesciencedb.jp:32888/bp3d-38321/API/*>
  Order deny,allow
  Deny from all
  allow from localhost 127.0.0.1 172.19.1
</Proxy>
<Proxy http://lifesciencedb.jp/bp3d/API/*>
  Order deny,allow
  Deny from all
  allow from localhost 127.0.0.1 172.19.1
</Proxy>

# BodyParts3D   2.0
ProxyPassMatch ^.*/bp3d/2.0.1006240000/(.*)$ balancer://cluster25/renderer/$1
# BodyParts3D   3.0
ProxyPassMatch ^.*/bp3d/3.0/(.*)$ balancer://cluster40/renderer/$1


# BodyParts3D Brain     3.0
#ProxyPassMatch ^.*/BrainBp3d/2.1.1008271800/(.*)$ balancer://cluster29/renderer/$1
#ProxyPassMatch ^.*/BrainBp3d/3.0.1109151400/(.*)$ balancer://cluster87/renderer/$1

# Talairach Brain Atlas None
#ProxyPassMatch ^.*/Talairach/1.1.1008301523/(.*)$ balancer://cluster30/renderer/$1

# Atlas of the Human Brain      3rd Edition
#ProxyPassMatch ^.*/BrainMAI/1.1.1003231730/(.*)$ balancer://cluster12/renderer/$1

# SPL-PNL Brain Atlas 2008      2008 March
#ProxyPassMatch ^.*/BrainSPLPNL/1.1.1004131730/(.*)$ balancer://cluster18/renderer/$1

# ag01 172.18.5.51
# ag02 172.18.5.52
# ag03 172.18.5.53
# ag04 172.18.5.54
# ag05 172.18.5.55

<Proxy balancer://cluster25>
  ProxySet lbmethod=byrequests maxattempts=2 nofailover=Off timeout=300
  BalancerMember http://172.18.5.51:8051 connectiontimeout=1 retry=5 timeout=300 ttl=5
  BalancerMember http://172.18.5.53:8051 connectiontimeout=1 retry=5 timeout=300 ttl=5
  BalancerMember http://172.18.5.54:8051 connectiontimeout=1 retry=5 timeout=300 ttl=5
#    BalancerMember http://172.18.5.55:8051 connectiontimeout=1 retry=5 timeout=300 ttl=5
</Proxy>
<Proxy balancer://cluster40>
  ProxySet lbmethod=byrequests maxattempts=2 nofailover=Off timeout=300
  BalancerMember http://172.18.5.51:8081 connectiontimeout=1 retry=5 timeout=300 ttl=5
  BalancerMember http://172.18.5.53:8081 connectiontimeout=1 retry=5 timeout=300 ttl=5
  BalancerMember http://172.18.5.54:8081 connectiontimeout=1 retry=5 timeout=300 ttl=5
#    BalancerMember http://172.18.5.55:8081 connectiontimeout=1 retry=5 timeout=300 ttl=5
</Proxy>

#<Proxy balancer://cluster29>
#  ProxySet lbmethod=byrequests maxattempts=2 nofailover=Off timeout=300
#  BalancerMember http://172.18.5.51:8059 connectiontimeout=1 retry=5 timeout=300 ttl=5
#  BalancerMember http://172.18.5.53:8059 connectiontimeout=1 retry=5 timeout=300 ttl=5
#  BalancerMember http://172.18.5.54:8059 connectiontimeout=1 retry=5 timeout=300 ttl=5
##    BalancerMember http://172.18.5.55:8059 connectiontimeout=1 retry=5 timeout=300 ttl=5
#</Proxy>
#<Proxy balancer://cluster87>
#  ProxySet lbmethod=byrequests maxattempts=2 nofailover=Off timeout=300
#  BalancerMember http://172.18.5.51:8087 connectiontimeout=1 retry=5 timeout=300 ttl=5
#  BalancerMember http://172.18.5.53:8087 connectiontimeout=1 retry=5 timeout=300 ttl=5
#  BalancerMember http://172.18.5.54:8087 connectiontimeout=1 retry=5 timeout=300 ttl=5
##    BalancerMember http://172.18.5.55:8087 connectiontimeout=1 retry=5 timeout=300 ttl=5
#</Proxy>

#<Proxy balancer://cluster30>
#  ProxySet lbmethod=byrequests maxattempts=2 nofailover=Off timeout=300
#  BalancerMember http://172.18.5.51:8061 connectiontimeout=1 retry=5 timeout=300 ttl=5
#  BalancerMember http://172.18.5.53:8061 connectiontimeout=1 retry=5 timeout=300 ttl=5
#  BalancerMember http://172.18.5.54:8061 connectiontimeout=1 retry=5 timeout=300 ttl=5
#    BalancerMember http://172.18.5.55:8061 connectiontimeout=1 retry=5 timeout=300 ttl=5
#</Proxy>

#<Proxy balancer://cluster12>
#  ProxySet lbmethod=byrequests maxattempts=2 nofailover=Off timeout=300
#  BalancerMember http://172.18.5.51:8025 connectiontimeout=1 retry=5 timeout=300 ttl=5
#  BalancerMember http://172.18.5.53:8025 connectiontimeout=1 retry=5 timeout=300 ttl=5
#  BalancerMember http://172.18.5.54:8025 connectiontimeout=1 retry=5 timeout=300 ttl=5
##    BalancerMember http://172.18.5.55:8025 connectiontimeout=1 retry=5 timeout=300 ttl=5
#</Proxy>

#<Proxy balancer://cluster18>
#  ProxySet lbmethod=byrequests maxattempts=2 nofailover=Off timeout=300
#  BalancerMember http://172.18.5.51:8037 connectiontimeout=1 retry=5 timeout=300 ttl=5
#  BalancerMember http://172.18.5.53:8037 connectiontimeout=1 retry=5 timeout=300 ttl=5
#  BalancerMember http://172.18.5.54:8037 connectiontimeout=1 retry=5 timeout=300 ttl=5
##    BalancerMember http://172.18.5.55:8037 connectiontimeout=1 retry=5 timeout=300 ttl=5
#</Proxy>

#SetEnvIf X-Balancer-Request 1 HAVE_MyRequestHeader
Header add X-Balancer-Information "%D %t %{BALANCER_WORKER_NAME}e" env=BALANCER_WORKER_NAME

Include /opt/services/ag/BackStageEditor/local/etc/httpd/renderer_conf/ag-renderer-include.conf
