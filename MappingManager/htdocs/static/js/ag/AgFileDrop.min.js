window.AgApp=window.AgApp||function(config){};window.AgApp.prototype.fileDragover=function(event){if(event&&event.stopEvent){event.stopEvent()}return false};window.AgApp.prototype.fileDragenter=function(event){if(event&&event.stopEvent){event.stopEvent()}return false};window.AgApp.prototype.fileDropCancel=function(event){if(event&&event.stopEvent){event.stopEvent()}return false};window.AgApp.prototype.fileDrop=function(event,eOpt){var self=this;try{delete self.__dropfile_total;delete self.__dropfile_count;delete self.__dropfiles;delete self.__dropfolders;delete self.__dropreaders;delete self.__dropfile_callback;self.__dropfile_total=0;self.__dropfile_count=0;self.__dropfiles=[];self.__dropfolders=[];self.__dropreaders=[];self.__dropfile_callback=(eOpt||{}).callback;var dataTransfer;if(Ext.isObject(event)){if(event.browserEvent&&event.browserEvent.dataTransfer){dataTransfer=event.browserEvent.dataTransfer}else{if(event.dataTransfer){dataTransfer=event.dataTransfer}}}if(dataTransfer){if(dataTransfer.items&&dataTransfer.items.length>0){var items=dataTransfer.items,len=items.length,i;self.__dropfile_total=len;for(i=0;i<len;i++){var item=items[i],entry;if(item.getAsEntry){entry=item.getAsEntry()}else{if(item.webkitGetAsEntry){entry=item.webkitGetAsEntry()}}if(entry){self._fileDropEntry(entry)}}}else{if(dataTransfer.files&&dataTransfer.files.length>0){var files=dataTransfer.files,len=files.length,i;self.__dropfile_total=len;for(i=0;i<len;i++){var reader=new FileReader();reader.__file=files[i];reader.onload=function(e){};reader.onabort=function(e){};reader.onerror=function(e){console.error(e.target.error);var msg=e.target.error.name;if(e.target.error.message){msg+=" : "+e.target.error.message}Ext.Msg.show({title:e.target.__file.name,msg:msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})};reader.onloadend=function(e){self.__dropfile_count++;if(e.target.result){self.__dropfiles.push(e.target.__file)}self.__dropreaders.push(e.target);if(self.__dropfile_count===self.__dropfile_total){if(Ext.isFunction(self.__dropfile_callback)){Ext.defer(function(){self.__dropfile_callback.apply(self,[self.__dropfiles,self.__dropfolders,self.__dropreaders])},0)}}};reader.onloadstart=function(e){};reader.onprogress=function(e){};reader.readAsText(files[i])}}}}}catch(e){console.error(e)}if(event&&event.stopEvent){event.stopEvent()}return false};window.AgApp.prototype._fileDropEntry=function(entry,directoryEntry){var self=this;if(entry.isFile){entry.file(function(file){var reader=new FileReader();file.__directoryEntry=directoryEntry;reader.__file=file;reader.onload=function(e){};reader.onabort=function(e){};reader.onerror=function(e){console.error(e.target.error);var msg=e.target.error.name;if(e.target.error.message){msg+=" : "+e.target.error.message}Ext.Msg.show({title:e.target.__file.name,msg:msg,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})};reader.onloadend=function(e){self.__dropfile_count++;if(e.target.result){self.__dropfiles.push(e.target.__file)}self.__dropreaders.push(e.target);if(self.__dropfile_count===self.__dropfile_total){if(Ext.isFunction(self.__dropfile_callback)){Ext.defer(function(){self.__dropfile_callback.apply(self,[self.__dropfiles,self.__dropfolders,self.__dropreaders])},0)}}};reader.onloadstart=function(e){};reader.onprogress=function(e){};reader.readAsText(file)})}else{if(entry.isDirectory){self.__dropfolders.push(entry);var reader=entry.createReader();reader.readEntries(function(results){var len=results.length,i;self.__dropfile_total--;self.__dropfile_total+=len;for(i=0;i<len;i++){self._fileDropEntry(results[i],entry)}},function(error){console.error(error);alert("読み込みに失敗しました。")})}}},window.AgApp.prototype.initFileDrop=function(){var self=this;Ext.getBody().on({dragover:self.fileDragover,dragenter:self.fileDragenter,drop:self.fileDropCancel,scope:self})};